<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>ChadNova AI | Dashboard</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <link rel="stylesheet" href="style.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="main.js"></script>
    <style>
        :root { --chad-green: #198754; --chad-dark: #1e293b; }
        .navbar { background-color: var(--chad-dark) !important; }
        .btn-success { background-color: var(--chad-green); border: none; }
        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; }
    </style>
</head>
<body class="bg-light">
    <!-- NAVBAR -->
    <nav class="navbar navbar-expand-lg navbar-dark shadow-sm py-3">
        <div class="container">
            <a class="navbar-brand fw-bold" href="/">
                <i class="fa-solid fa-leaf text-success me-2"></i>CHADNOVA AI
            </a>
            <div class="navbar-nav ms-auto">
                <a class="nav-link" href="/">Core Concepts</a>
                <a class="nav-link btn btn-outline-success text-white px-3 ms-lg-3" href="predict.html">Launch Predictor</a>
                <a class="nav-link ms-3" href="dashboard.html">
                    <i class="fa-solid fa-chart-line"></i> Dashboard
                </a>
            </div>
        </div>
    </nav>

    <div class="container-fluid mt-5 px-5">
        <!-- REPORT SECTION -->
        <div id="reportSection" class="card shadow-lg border-0 p-5 bg-white border-start border-primary border-5 d-none mb-5" data-aos="zoom-in">
            <div class="d-flex justify-content-between align-items-center mb-4">
                <div>
                    <h2 class="text-primary fw-bold">Simulation Analysis Report</h2>
                    <p class="text-muted mb-0">Forecast Year: <span id="reportYearHeader">2025</span> | Comparison Baseline: 1990 - 2013</p>
                </div>
                <div class="no-print">
                    <button onclick="window.print()" class="btn btn-outline-dark fw-bold me-2">
                        <i class="fa-solid fa-file-pdf me-2"></i> DOWNLOAD PDF
                    </button>
                    <a href="predict.html" class="btn btn-success fw-bold">
                        <i class="fa-solid fa-plus me-2"></i> NEW PREDICTION
                    </a>
                </div>
            </div>

            <div class="table-responsive rounded border mb-4">
                <table class="table table-hover mb-0">
                    <thead class="table-light">
                        <tr>
                            <th>Metric Parameter</th>
                            <th>2013 Baseline</th>
                            <th id="forecastTableHeader">Target Forecast</th>
                            <th>Performance Delta (%)</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td><strong>Crop Yield (hg/ha)</strong></td>
                            <td id="tableBaseline">-</td>
                            <td id="tableForecast" class="fw-bold">-</td>
                            <td id="tableDelta" class="fw-bold">-</td>
                        </tr>
                        <tr>
                            <td>Production Stability</td>
                            <td>Historical Average</td>
                            <td>Simulated Projection</td>
                            <td id="tableStability">-</td>
                        </tr>
                    </tbody>
                </table>
            </div>

            <div class="alert p-3 border-0 rounded" id="summaryAlert">
                <p id="summaryText" class="mb-0"></p>
            </div>
        </div>

        <div class="row">
            <!-- LEFT PANEL -->
            <div class="col-md-4 no-print" data-aos="fade-right">
                <div class="card shadow border-0 p-4 mb-4">
                    <div class="d-flex justify-content-between align-items-center mb-3">
                        <h4 class="text-success mb-0">Simulation</h4>
                        <div class="form-check form-switch">
                            <input class="form-check-input" type="checkbox" id="liveToggle" onchange="toggleManualMode()">
                            <label class="small fw-bold">Live Data</label>
                        </div>
                    </div>
                    
                    <div id="liveFetchContainer" class="d-none mb-3">
                        <button onclick="fetchWeatherData()" class="btn btn-outline-primary btn-sm w-100">
                            <i class="fa-solid fa-cloud-bolt me-2"></i> FETCH LIVE WEATHER
                        </button>
                    </div>

                    <div class="mb-3">
                        <label class="small fw-bold">Country</label>
                        <select id="countrySelect" class="form-select shadow-sm"></select>
                    </div>
                    <div class="mb-3">
                        <label class="small fw-bold">Crop</label>
                        <select id="cropSelect" class="form-select shadow-sm"></select>
                    </div>

                    <div class="mb-3">
                        <label class="small fw-bold">Forecast Year</label>
                        <select id="simYear" class="form-select shadow-sm">
                            <option value="2024">2024</option>
                            <option value="2025" selected>2025</option>
                            <option value="2026">2026</option>
                            <option value="2027">2027</option>
                            <option value="2030">2030 (Long Term)</option>
                        </select>
                    </div>

                    <div class="row g-2 mb-3">
                        <div class="col-6"><label class="small fw-bold">Rain (mm)</label><input type="number" id="simRain" class="form-control" value="1000"></div>
                        <div class="col-6"><label class="small fw-bold">Temp (Â°C)</label><input type="number" id="simTemp" class="form-control" value="25"></div>
                    </div>
                    <div class="mb-3">
                        <label class="small fw-bold">Pesticides (tonnes)</label>
                        <input type="number" id="simPest" class="form-control" value="100">
                    </div>
                    <button onclick="runSimulation()" class="btn btn-success w-100 fw-bold py-3 shadow-sm">GENERATE FINAL FORECAST</button>
                </div>
            </div>

            <!-- RIGHT PANEL (Chart) -->
            <div class="col-md-8">
                <div class="card shadow border-0 p-5 bg-white h-100">
                    <h3 class="fw-bold mb-4">Production Lifecycle Analysis</h3>
                    <canvas id="yieldTrendChart" style="max-height: 450px;"></canvas>
                    <div id="predictionLegend" class="mt-3 small text-center d-none">
                        <span class="me-3"><i class="fa-solid fa-circle text-success"></i> Historical Data</span>
                        <span><i class="fa-solid fa-circle text-primary"></i> AI <span id="legendYear">2025</span> Forecast Point</span>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Load metadata (countries & crops) from backend API
        fetch(`{API_BASE_URL}/get_metadata`)
            .then(res => res.json())
            .then(data => {
                const countrySelect = document.getElementById("countrySelect");
                const cropSelect = document.getElementById("cropSelect");
                data.countries.forEach(c => {
                    const opt = document.createElement("option");
                    opt.value = c; opt.textContent = c;
                    countrySelect.appendChild(opt);
                });
                data.crops.forEach(c => {
                    const opt = document.createElement("option");
                    opt.value = c; opt.textContent = c;
                    cropSelect.appendChild(opt);
                });
            });
    </script>
</body>
</html>
